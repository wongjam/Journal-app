{% extends "base.html" %}
{% if mode == "new" %}
  {% set page_title = t("写文章") %}
{% else %}
  {% set page_title = t("编辑文章") %}
{% endif %}
{% block title %}{{ page_title }} · {{ t("我的心得") }}{% endblock %}

{% block content %}
<div class="row justify-content-center">
  <div class="col-12 col-xl-9">
    <div class="card shadow-sm">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center">
          <h4 class="mb-0">{{ page_title }}</h4>
          <a class="btn btn-sm btn-outline-secondary" href="{{ url_for('index') }}">{{ t("返回列表") }}</a>
        </div>

        <form class="mt-3" method="post"
          action="{% if mode == 'new' %}{{ url_for('create_post') }}{% else %}{{ url_for('update_post', post_id=post.id) }}{% endif %}">
          <div class="mb-3">
            <label class="form-label">{{ t("标题") }}</label>
            <input class="form-control form-control-lg" name="title" value="{{ post.title if post else '' }}" placeholder="{{ t('例如：今天我意识到……') }}" required>
          </div>

          <div class="mb-3">
            <label class="form-label">{{ t("分类") }}</label>
            <select class="form-select" name="category" required>
              <option value="" disabled {% if not post %}selected{% endif %}>{{ t("请选择分类") }}</option>
              {% for c in categories %}
                <option value="{{ c.id }}" {% if post and post.category == c.id %}selected{% endif %}>{{ c.name }}</option>
              {% endfor %}
            </select>
            <div class="form-text">{{ t("没有合适分类？去「分类管理」新建。") }}</div>
          </div>

          <div class="mb-3">
            <label class="form-label">{{ t("正文") }}</label>
            <textarea id="content" class="form-control font-mono" name="content" rows="16"
              placeholder="{{ t('支持缩进：按 Tab 插入 4 个空格，也支持 Shift+Tab 反向缩进。') }}" required>{{ post.content if post else '' }}</textarea>
            <div class="d-flex gap-2 mt-2">
              <button type="button" class="btn btn-sm btn-outline-secondary" id="btnIndent">{{ t("缩进") }}</button>
              <button type="button" class="btn btn-sm btn-outline-secondary" id="btnOutdent">{{ t("反缩进") }}</button>
              <button type="button" class="btn btn-sm btn-outline-secondary" id="btnInsertDate">{{ t("插入时间") }}</button>
            </div>
          </div>

          <div class="d-grid d-md-flex gap-2 justify-content-md-end">
            <button class="btn btn-primary btn-lg" type="submit">{{ t("保存") }}</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
  setupIndentEditor({
    textareaId: "content",
    indentBtnId: "btnIndent",
    outdentBtnId: "btnOutdent",
    insertDateBtnId: "btnInsertDate"
  });
</script>
{% endblock %}
